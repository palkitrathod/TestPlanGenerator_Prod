<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Plan.ai | Professional Generator</title>
    <!-- Fonts: Outfit (Headings) & Inter (Body) -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #f0f4ff 0%, #e2e8f0 100%);
            --accent-color: #4f46e5;
            --accent-hover: #4338ca;
            --text-heading: #1e293b;
            --text-body: #475569;
            --card-surface: #ffffff;
            --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-body);
            min-height: 100vh;
            padding: 30px 0;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Outfit', sans-serif;
            color: var(--text-heading);
        }

        .app-header {
            text-align: center;
            margin-bottom: 2rem;
            animation: fadeInDown 0.6s ease-out;
        }

        .app-header h1 {
            font-weight: 700;
            font-size: 2.5rem;
            letter-spacing: -0.03em;
            background: linear-gradient(to right, #4f46e5, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .app-header p {
            font-size: 1.1rem;
            color: #64748b;
            margin-top: 0.5rem;
        }

        .wizard-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .main-card {
            background: var(--card-surface);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-soft);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        /* Decorative Elements */
        .main-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, #4f46e5, #8b5cf6, #ec4899);
        }

        .form-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
            border-color: #cbd5e1;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 12px;
        }

        .section-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: #e0e7ff;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .form-label {
            font-weight: 500;
            font-size: 0.9rem;
            color: #334155;
            margin-bottom: 0.4rem;
        }

        .form-control,
        .form-select {
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            padding: 0.6rem 0.9rem;
            font-size: 0.95rem;
            background-color: #fff;
            transition: all 0.2s;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
            outline: none;
        }

        /* Custom Checkboxes */
        .custom-check-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .custom-check-item {
            position: relative;
        }

        .custom-check-input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .custom-check-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #cbd5e1;
            background: #fff;
            color: #475569;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .custom-check-input:checked+.custom-check-label {
            background: #eef2ff;
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .custom-check-input:checked+.custom-check-label i {
            transform: scale(1.1);
        }

        .btn-generate {
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
            border: none;
            border-radius: 12px;
            padding: 16px;
            width: 100%;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            letter-spacing: 0.02em;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3);
            transition: all 0.2s;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.4);
        }

        /* Preview Area */
        .doc-preview-container {
            background: #525659;
            padding: 40px;
            border-radius: 12px;
            margin-top: 2rem;
            max-height: 80vh;
            overflow-y: auto;
        }

        .doc-paper {
            background: white;
            max-width: 800px;
            margin: 0 auto;
            padding: 60px;
            min-height: 1000px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            font-family: 'Times New Roman', serif;
            color: #000;
        }

        .doc-paper h1.doc-title {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            margin-bottom: 40px;
            font-family: Arial, sans-serif;
            font-weight: bold;
        }

        .doc-heading {
            font-family: Arial, sans-serif;
            font-weight: bold;
            font-size: 1.1rem;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .doc-textarea {
            width: 100%;
            border: 1px dashed transparent;
            resize: vertical;
            overflow: hidden;
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.5;
            padding: 5px;
            background: transparent;
        }

        .doc-textarea:hover,
        .doc-textarea:focus {
            border-color: #cbd5e1;
            background: #f8fafc;
            outline: none;
        }

        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <div class="wizard-container">

        <div class="app-header">
            <h1><i class="fas fa-rocket"></i> Test Plan Generator</h1>
            <p>Developed by Palkit Rathod</p>
        </div>

        <!-- Input Form -->
        <div class="main-card form-container" id="inputSection">
            <form id="planForm">

                <div class="row">
                    <!-- Column 1: Core Info -->
                    <div class="col-lg-6">
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon"><i class="fas fa-info-circle"></i></div>
                                <h5 class="section-title">1. Project Overview</h5>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Project Name</label>
                                <input type="text" class="form-control" name="project_name"
                                    placeholder="e.g. Acme Mobile App V2" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Project Type</label>
                                <select class="form-select" name="project_type">
                                    <option>Web Application</option>
                                    <option>Mobile App (iOS/Android)</option>
                                    <option>API / Backend</option>
                                    <option>SaaS Platform</option>
                                    <option>Desktop Software</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Objective</label>
                                <textarea class="form-control" name="objective" rows="2"
                                    placeholder="e.g. Verify stability of new payment gateway integration..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Column 2: Scope -->
                    <div class="col-lg-6">
                        <div class="form-section">
                            <div class="section-header">
                                <div class="section-icon"><i class="fas fa-bullseye"></i></div>
                                <h5 class="section-title">2. Scope Definition</h5>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">In-Scope Features</label>
                                <textarea class="form-control" name="in_scope" rows="3"
                                    placeholder="List key modules..." required></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Out-of-Scope (Exclusions)</label>
                                <textarea class="form-control" name="out_scope" rows="2"
                                    placeholder="e.g. Dark Mode, Legacy Browser Support..."></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Assumptions & Dependencies</label>
                                <textarea class="form-control" name="assumptions" rows="2"
                                    placeholder="e.g. Test Data provided by Client..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Strategy & Automation -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-chess"></i></div>
                        <h5 class="section-title">3. Test Strategy & Plan</h5>
                    </div>

                    <label class="form-label d-block mb-3">Testing Types Required</label>
                    <div class="custom-check-group mb-4">
                        <div class="custom-check-item">
                            <input type="checkbox" class="custom-check-input" name="types" value="Functional" checked
                                id="c1">
                            <label class="custom-check-label" for="c1"><i class="fas fa-check-circle"></i>
                                Functional</label>
                        </div>
                        <div class="custom-check-item">
                            <input type="checkbox" class="custom-check-input" name="types" value="Regression" id="c2">
                            <label class="custom-check-label" for="c2"><i class="fas fa-sync"></i> Regression</label>
                        </div>
                        <div class="custom-check-item">
                            <input type="checkbox" class="custom-check-input" name="types" value="API" id="c3">
                            <label class="custom-check-label" for="c3"><i class="fas fa-network-wired"></i> API</label>
                        </div>
                        <div class="custom-check-item">
                            <input type="checkbox" class="custom-check-input" name="types" value="Performance" id="c4">
                            <label class="custom-check-label" for="c4"><i class="fas fa-tachometer-alt"></i>
                                Performance</label>
                        </div>
                        <div class="custom-check-item">
                            <input type="checkbox" class="custom-check-input" name="types" value="Security" id="c5">
                            <label class="custom-check-label" for="c5"><i class="fas fa-shield-alt"></i>
                                Security</label>
                        </div>
                        <div class="custom-check-item">
                            <input type="checkbox" class="custom-check-input" name="types" value="UAT" id="c6">
                            <label class="custom-check-label" for="c6"><i class="fas fa-user-check"></i> UAT
                                Support</label>
                        </div>
                        <div class="custom-check-item">
                            <input type="checkbox" class="custom-check-input" name="types" value="Automation" id="cAuto"
                                onchange="toggleAuto()">
                            <label class="custom-check-label" for="cAuto"><i class="fas fa-robot"></i>
                                Automation</label>
                        </div>
                    </div>

                    <div id="autoDetails" class="row g-3 mb-3"
                        style="display:none; background: #eef2ff; padding: 15px; border-radius: 8px;">
                        <div class="col-md-6">
                            <label class="form-label">Automation Tool</label>
                            <input type="text" class="form-control" name="auto_tool"
                                placeholder="e.g. Selenium/Cypress">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Framework</label>
                            <input type="text" class="form-control" name="auto_framework"
                                placeholder="e.g. TestNG/PyTest">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Test Data Strategy</label>
                            <input type="text" class="form-control" name="test_data"
                                placeholder="e.g. Synthetic data generated via scripts">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Defect Management Tool</label>
                            <select class="form-select" name="defect_tool">
                                <option>Jira</option>
                                <option>Azure DevOps</option>
                                <option>Bugzilla</option>
                                <option>GitHub Issues</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Governance (New Fields) -->
                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-tasks"></i></div>
                        <h5 class="section-title">4. Governance & Schedule</h5>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">RTM (Traceability)</label>
                            <input type="text" class="form-control" name="rtm_ref" placeholder="Project ID / Link">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Entry Criteria</label>
                            <input type="text" class="form-control" name="entry_criteria"
                                value="Smoke Test Passed, Env Ready">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Exit Criteria</label>
                            <input type="text" class="form-control" name="exit_criteria"
                                value="0 Critical Bugs, 100% Executed">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Risks & Mitigation</label>
                            <textarea class="form-control" name="risks" rows="2"
                                placeholder="e.g. Risk: Resource unavailability. Mitigation: Backup resource assigned."></textarea>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Reporting & Metrics</label>
                            <textarea class="form-control" name="metrics" rows="2"
                                placeholder="e.g. Weekly Status Rpt, Defect Density, Pass/Fail %"></textarea>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Start Date</label>
                            <input type="date" class="form-control" name="start_date" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">End Date</label>
                            <input type="date" class="form-control" name="end_date" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Sign-Off Owner</label>
                            <input type="text" class="form-control" name="sign_off" placeholder="e.g. QA Lead / PM">
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <button type="button" onclick="generatePreview()" class="btn-generate">
                        <i class="fas fa-magic me-2"></i> Generate
                    </button>
                </div>
            </form>
        </div>

        <!-- Preview Section (Initially Hidden) -->
        <div id="previewSection" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-secondary" onclick="showForm()"><i class="fas fa-arrow-left"></i> Back to
                    Edit</button>
                <button class="btn btn-success" onclick="downloadDocx()"><i class="fas fa-download"></i> Download
                    .DOCX</button>
            </div>

            <div class="doc-preview-container">
                <div class="doc-paper" id="paperContent">
                    <h1 class="doc-title">TEST PLAN</h1>

                    <!-- 1. Overview -->
                    <div class="doc-heading">1. TEST PLAN OVERVIEW</div>
                    <textarea class="doc-textarea" id="d_overview" rows="4"></textarea>

                    <!-- 2. Scope -->
                    <div class="doc-heading">2. SCOPE OF PROJECT</div>
                    <strong>a. In Scope</strong>
                    <textarea class="doc-textarea" id="d_inscope" rows="4"></textarea>

                    <div class="doc-heading">3. SCOPE OF TESTING</div>
                    <strong>a. In Scope</strong>
                    <textarea class="doc-textarea" id="d_test_inscope" rows="2"></textarea>
                    <strong>b. Out of Scope</strong>
                    <textarea class="doc-textarea" id="d_outscope" rows="2"></textarea>

                    <div class="doc-heading">4. ASSUMPTIONS & DEPENDENCIES</div>
                    <textarea class="doc-textarea" id="d_assumptions" rows="3"></textarea>

                    <div class="doc-heading">5. TEST STRATEGY & METHODOLOGY</div>
                    <textarea class="doc-textarea" id="d_strategy" rows="6"></textarea>

                    <div class="doc-heading">6. AUTOMATION PLAN</div>
                    <textarea class="doc-textarea" id="d_automation" rows="3"></textarea>

                    <div class="doc-heading">7. TEST ENVIRONMENT & DATA</div>
                    <textarea class="doc-textarea" id="d_env" rows="4"></textarea>

                    <div class="doc-heading">8. TRACEABILITY (RTM)</div>
                    <textarea class="doc-textarea" id="d_rtm" rows="2"></textarea>

                    <div class="doc-heading">9. PROCESS (ENTRY/EXIT)</div>
                    <textarea class="doc-textarea" id="d_process" rows="4"></textarea>

                    <div class="doc-heading">10. DEFECT MANAGEMENT & REPORTING</div>
                    <textarea class="doc-textarea" id="d_reporting" rows="4"></textarea>

                    <div class="doc-heading">11. RISKS & MITIGATION</div>
                    <textarea class="doc-textarea" id="d_risks" rows="3"></textarea>

                    <div class="doc-heading">12. SCHEDULE & APPROVAL</div>
                    <textarea class="doc-textarea" id="d_schedule" rows="5"></textarea>

                </div>
            </div>
        </div>

    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay">
        <div class="spinner-grow text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
        <h4 class="mt-3">Architecting your Plan...</h4>
        <p class="text-muted">Analyzing inputs & formatting IEEE structure</p>
    </div>

    <script>
        function toggleAuto() {
            const check = document.getElementById('cAuto');
            document.getElementById('autoDetails').style.display = check.checked ? 'flex' : 'none';
        }

        function generatePreview() {
            // Simply map form values to the document preview TEXTAREAS
            // We do this client-side for instant feedback

            document.getElementById('loadingOverlay').style.display = 'flex';
            setTimeout(() => {
                const f = document.forms['planForm'];

                // 1. Overview
                document.getElementById('d_overview').value =
                    `Project: ${f.project_name.value}\nType: ${f.project_type.value}\n\nObjective:\n${f.objective.value || 'To ensure the quality and stability of the release.'}`;

                // 2. Scope
                document.getElementById('d_inscope').value = f.in_scope.value;
                document.getElementById('d_test_inscope').value = "Verification of all features listed above.";
                document.getElementById('d_outscope').value = f.out_scope.value || "N/A";

                // 4. Assumptions
                document.getElementById('d_assumptions').value = f.assumptions.value || "Standard QA assumptions apply.";

                // 5. Strategy
                let strat = "Testing Types:\n";
                document.querySelectorAll('input[name="types"]:checked').forEach(c => strat += `- ${c.value}\n`);
                strat += `\nDefect Tool: ${f.defect_tool.value}`;
                document.getElementById('d_strategy').value = strat;

                // 6. Automation
                if (document.getElementById('cAuto').checked) {
                    document.getElementById('d_automation').value =
                        `Tool: ${f.auto_tool.value}\nFramework: ${f.auto_framework.value}\nStrategy: Automated regression suite execution.`;
                } else {
                    document.getElementById('d_automation').value = "Manual Testing only for this release.";
                }

                // 7. Env
                document.getElementById('d_env').value = `Data Strategy: ${f.test_data.value}\nEnvironment: QA / Staging`;

                // 8. RTM
                document.getElementById('d_rtm').value = f.rtm_ref.value ? `Traceability linked to Project ID: ${f.rtm_ref.value}` : "N/A";

                // 9. Process
                document.getElementById('d_process').value =
                    `Entry Criteria: ${f.entry_criteria.value}\nExit Criteria: ${f.exit_criteria.value}`;

                // 10. Reporting
                document.getElementById('d_reporting').value = f.metrics.value || "Daily Status Reports & Defect Metrics";

                // 11. Risks
                document.getElementById('d_risks').value = f.risks.value || "None identified.";

                // 12. Schedule
                document.getElementById('d_schedule').value =
                    `Start: ${f.start_date.value}\nEnd: ${f.end_date.value}\n\nSign-off Authority: ${f.sign_off.value}`;

                document.getElementById('loadingOverlay').style.display = 'none';
                document.getElementById('inputSection').style.display = 'none';
                document.getElementById('previewSection').style.display = 'block';
                window.scrollTo(0, 0);

            }, 800);
        }

        function showForm() {
            document.getElementById('inputSection').style.display = 'block';
            document.getElementById('previewSection').style.display = 'none';
        }

        async function downloadDocx() {
            // Gather text from PREVIEW fields (user might have edited them)
            const payload = {
                project_name: document.forms['planForm'].project_name.value,
                overview: document.getElementById('d_overview').value,
                inscope: document.getElementById('d_inscope').value,
                outscope: document.getElementById('d_outscope').value,
                assumptions: document.getElementById('d_assumptions').value,
                strategy: document.getElementById('d_strategy').value,
                automation: document.getElementById('d_automation').value,
                env: document.getElementById('d_env').value,
                process: document.getElementById('d_process').value,
                reporting: document.getElementById('d_reporting').value,
                risks: document.getElementById('d_risks').value,
                schedule: document.getElementById('d_schedule').value,
                rtm: document.getElementById('d_rtm').value
            };

            const response = await fetch('/generate-final', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `TestPlan_${payload.project_name.replace(/\s+/g, '_')}.docx`;
                document.body.appendChild(a); a.click(); a.remove();
            }
        }
    </script>
</body>

</html>